{% extends 'app/layouts/base.html' %}

{% block title %}{{ schedule.name }}{% endblock title %}

{% block body %}
    <h1>{{ schedule.name }}</h1>
    <div class="card d-inline-block mb-2">
        <div class="card-body p-2">
            {# allauth why the hell are you like this #}
            <img class="me-1 rounded" src="{{ schedule.owner.socialaccount_set.all.0.get_avatar_url }}" alt="{{ schedule.owner.socialaccount_set.all.0.extra_data.name }}'s profile picture" style="width: 35px">
            {{ schedule.owner.socialaccount_set.all.0.extra_data.name }} (<a href="mailto:{{ schedule.owner.email }}">{{ schedule.owner.email }}</a>)
        </div>
    </div>
    
    <form v-scope="{ checked: 0 }" class="card" method="POST">
        {% csrf_token %}
        <div class="card-header">
            {% block schedule_head %}
            {% endblock schedule_head %}
        </div>
        {% if user == schedule.owner %}
            <div class="w-100 ps-3 p-2 bg-light shadow-sm rounded" v-scope="{ checkboxes: Array.from(document.querySelectorAll('#timeslot-body input[type=checkbox]')) }">
                <script>
                    function selectAll(checkboxes) {
                        // If some checkboxes are checked, click the ones that are unchecked
                        if (!checkboxes.every((x, _, a) => x.checked == a[0].checked))
                            checkboxes.filter(x => !x.checked).forEach(x => x.click())
                        else // Click all the checkboxes
                            checkboxes.forEach(x => x.click())
                    }
                </script>
                <button class="btn btn-primary" type="button" @click="selectAll(checkboxes)">
                    <div class="border border-light d-inline-flex m-0 mt-1 me-1 p-0 rounded">
                        <input
                            class="text-danger form-check-input p-0 m-0"
                            type="checkbox"
                            v-bind:checked="checkboxes.length == checked && checkboxes.length != 0"
                            style="width: 15px; height: 15px;" />
                    </div>
                    Select All
                </button>
                <button onclick="return confirm(`Are you sure you want to delete these timeslots?`)" formaction="{% url 'schedule-delete' schedule.id %}" class="btn btn-danger" v-bind:disabled="checked == 0"><i class="far fa-trash-alt"></i> Delete</button>
                <button formaction="{% url 'schedule-lock' schedule.id %}" class="btn btn-warning" v-bind:disabled="checked == 0"><i class="fas fa-lock"></i> Lock/Unlock</button>
            </div>
        {% endif %}
        <div class="card-body" id="timeslot-body">
            {% block schedule_body %}
            {% endblock schedule_body %}
        </div>
    </form>
    
{% endblock body %}
