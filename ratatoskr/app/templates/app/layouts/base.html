{% load socialaccount %}
{% load static %}
{% load sass_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock title %} | Ratatoskr</title>
    {% comment %} Styles {% endcomment %}
    <link rel="stylesheet" href="{% sass_src 'scss/style.scss' %}">
    <link href="{% static 'fontawesomefree/css/all.min.css' %}" rel="stylesheet" type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% sass_src 'css/base.css' %}">
    {% comment %} Libraries {% endcomment %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/petite-vue"></script>
    {% block head %}
    {% endblock head %}
</head>
<body id="body-pd">
    <div class="l-navbar" id="nav-bar">
     <nav class="nav">
        <div>
           <a href="#" class="nav_logo header_toggle"> <i class='bx bx-menu nav_logo-icon' id="header-toggle"></i> <span class="nav_logo-name">Ratatoskr</span> </a>
           <div class="nav_list">
               <a href="/" class="nav_link {% if request.path == "/" %}active{% endif %}"> <i class='bx bx-search nav_icon'></i> <span class="nav_name">Find Teacher</span> </a>
               {% if user.is_authenticated and "worcesterschools.net" in user.email and "student." not in user.email %}
                   <a href="/schedules" class="nav_link {% if request.path == "/schedules/" %}active{% endif %}"> <i class='bx bxs-calendar-alt nav_icon'></i> <span class="nav_name">My Schedules</span> </a>
                   <a href="/upcoming" class="nav_link {% if request.path == "/upcoming/" %}active{% endif %}"> <i class='bx bxs-timer nav_icon'></i> <span class="nav_name">Upcoming Meetings</span> </a>
               {% endif %}
               <a href="/help" class="nav_link {% if request.path == "/help/" %}active{% endif %}"> <i class='bx bx-help-circle nav_icon'></i> <span class="nav_name">Help</span> </a>
               <a href="/settings" class="nav_link {% if request.path == "/settings/" %}active{% endif %}"> <i class='bx bx-cog nav_icon'></i> <span class="nav_name">Settings</span> </a>
           </div>
        </div>

         <div>
             {% if user.is_authenticated %}
                <p class="nav_link fw-bold" style="color: var(--white-color) !important"><img class="rounded me-2" style="width: 20px;" src="{{ user.socialaccount_set.all.0.get_avatar_url }}" alt="" srcset=""> Hello, {{ user.first_name }}!</p>
                 <form class="d-inline" action="{% url "logout" %}?next=/" method="post">
                    {% csrf_token %}
                    <button class="button-blank nav_link"> <i class='bx bx-log-out nav_icon'></i> <span class="nav_name">Sign Out</span> </button>
                 </form>
             {% else %}
             <form class="d-inline" action="{% provider_login_url "google" %}" method="post">
                {% csrf_token %}
                <button class="button-blank nav_link" type="submit">
                    <i class='bx bx-log-in nav_icon'></i> <span class="nav_name">Sign In</span>
                </button>
             </form>
             {% endif %}
         </div>
     </nav>
  </div>

    <main class="container my-5 height-100">
        {% block body %}
        {% endblock body %}
    </main>

    <!--
    No clue what this does...
    <script>
        // nya~
        window.onload = () => {
            PetiteVue.createApp({
                $delimiters: ["${", "}"]
            }).mount()
            let tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            let tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })
        }
    </script>-->
    <script>
         document.addEventListener("DOMContentLoaded", function(event) {
            const toggle = document.getElementById('header-toggle');
            const nav = document.getElementById('nav-bar');
            const body = document.querySelector('body');

            if (toggle && nav && body) {
                toggle.addEventListener('click', () => {
                    nav.classList.toggle('show');
                    toggle.classList.toggle('bx-x');
                    body.classList.toggle('body-pd');
                });
            }
         });
      </script>
    </body>
</html>
